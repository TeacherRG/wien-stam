<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kontrolle von Mezuzot und Tefillin in Wien 2025</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}
body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
display: flex;
align-items: center;
justify-content: center;
padding: 20px;
}
.container {
background: white;
border-radius: 20px;
box-shadow: 0 20px 40px rgba(0,0,0,0.1);
padding: 40px;
max-width: 500px;
width: 100%;
animation: slideUp 0.6s ease-out;
overflow: hidden;
}
@keyframes slideUp {
from {
opacity: 0;
transform: translateY(30px);
}
to {
opacity: 1;
transform: translateY(0);
}
}
.header {
text-align: center;
margin-bottom: 30px;
}
.header h1 {
color: #2d3748;
font-size: 28px;
margin-bottom: 8px;
font-weight: 700;
}
.header p {
color: #718096;
font-size: 16px;
}
.form-group {
margin-bottom: 25px;
}
label {
display: block;
margin-bottom: 8px;
color: #2d3748;
font-weight: 600;
font-size: 14px;
}
input, select {
width: 100%;
padding: 12px 16px;
border: 2px solid #e2e8f0;
border-radius: 12px;
font-size: 16px;
transition: all 0.3s ease;
background: #f7fafc;
}
input:focus, select:focus {
outline: none;
border-color: #667eea;
background: white;
box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}
.slot-option {
padding: 15px 20px;
border: 2px solid #e2e8f0;
border-radius: 12px;
background: #f7fafc;
cursor: pointer;
transition: all 0.3s ease;
text-align: center;
font-weight: 500;
}
.slot-option:hover {
border-color: #667eea;
background: #edf2f7;
transform: translateY(-2px);
}
.slot-option.selected {
border-color: #667eea;
background: #667eea;
color: white;
box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}
.slot-option.booked {
background: #fed7d7;
border-color: #fc8181;
color: #c53030;
cursor: not-allowed;
opacity: 0.6;
}
.slot-option.booked:hover {
transform: none;
}
.calendar {
display: grid;
grid-template-columns: repeat(7, 1fr);
gap: 8px;
margin-top: 15px;
padding: 20px;
background: #f7fafc;
border-radius: 12px;
border: 2px solid #e2e8f0;
width: 100%;
box-sizing: border-box;
max-width: 100%;
min-width: 0;
overflow-x: auto;
}
.calendar-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
padding: 0 10px;
width: 100%;
box-sizing: border-box;
}
.calendar-nav {
background: #667eea;
color: white;
border: none;
border-radius: 8px;
padding: 8px 12px;
cursor: pointer;
font-size: 16px;
font-weight: bold;
}
.calendar-nav:hover {
background: #5a6fd8;
}
.calendar-month {
font-size: 18px;
font-weight: 600;
color: #2d3748;
}
.calendar-day-header {
text-align: center;
font-weight: 600;
color: #4a5568;
padding: 10px 5px;
font-size: 14px;
min-width: 0;
word-break: break-word;
}
.calendar-day {
aspect-ratio: 1;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
background: white;
border: 2px solid #e2e8f0;
border-radius: 8px;
cursor: pointer;
transition: all 0.3s ease;
font-weight: 500;
position: relative;
min-height: 60px;
min-width: 0;
word-break: break-word;
}
.calendar-day:hover:not(.disabled):not(.other-month) {
border-color: #667eea;
background: #edf2f7;
transform: scale(1.05);
}
.calendar-day.selected {
border-color: #667eea;
background: #667eea;
color: white;
box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}
.calendar-day.disabled {
background: #f7fafc;
color: #a0aec0;
cursor: not-allowed;
opacity: 0.6;
}
.calendar-day.other-month {
color: #cbd5e0;
background: #f7fafc;
}
.calendar-day.has-slots {
border-color: #48bb78;
background: #f0fff4;
}
.calendar-day.has-slots:hover {
border-color: #38a169;
background: #c6f6d5;
}
.calendar-day.fully-booked {
background: #fed7d7;
border-color: #fc8181;
color: #c53030;
}
.calendar-day-number {
font-size: 16px;
margin-bottom: 2px;
}
.calendar-day-slots {
font-size: 10px;
opacity: 0.8;
}
.slot-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 12px;
margin-top: 15px;
}
.submit-btn {
width: 100%;
padding: 15px;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
border: none;
border-radius: 12px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
margin-top: 20px;
}
.submit-btn:hover:not(:disabled) {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
}
.submit-btn:disabled {
opacity: 0.6;
cursor: not-allowed;
transform: none;
}
.success-message {
background: #c6f6d5;
color: #22543d;
padding: 15px 20px;
border-radius: 12px;
margin-top: 20px;
text-align: center;
font-weight: 500;
border: 2px solid #9ae6b4;
}
.error-message {
background: #fed7d7;
color: #c53030;
padding: 15px 20px;
border-radius: 12px;
margin-top: 20px;
text-align: center;
font-weight: 500;
border: 2px solid #fc8181;
}
.loading {
display: inline-block;
width: 20px;
height: 20px;
border: 3px solid #ffffff;
border-radius: 50%;
border-top-color: transparent;
animation: spin 1s ease-in-out infinite;
margin-right: 10px;
}
@keyframes spin {
to { transform: rotate(360deg); }
}
.info-box {
background: #ebf8ff;
border: 2px solid #90cdf4;
border-radius: 12px;
padding: 20px;
margin-bottom: 25px;
color: #2a4365;
}
.info-box h3 {
margin-bottom: 10px;
color: #2c5282;
}
.info-box ul {
list-style-position: inside;
line-height: 1.6;
}
.admin-panel {
position: fixed;
top: 20px;
right: 20px;
z-index: 1000;
}
.admin-btn {
background: #2d3748;
color: white;
border: none;
border-radius: 50%;
width: 50px;
height: 50px;
cursor: pointer;
font-size: 18px;
box-shadow: 0 4px 12px rgba(0,0,0,0.3);
transition: all 0.3s ease;
}
.admin-btn:hover {
background: #4a5568;
transform: scale(1.1);
}
.admin-modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0,0,0,0.8);
z-index: 2000;
display: none;
align-items: center;
justify-content: center;
}
.admin-content {
background: white;
border-radius: 20px;
padding: 30px;
max-width: 800px;
width: 90%;
max-height: 80vh;
overflow-y: auto;
}
.admin-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}
.close-btn {
background: none;
border: none;
font-size: 24px;
cursor: pointer;
color: #666;
}
.bookings-table {
width: 100%;
border-collapse: collapse;
margin-top: 20px;
}
.bookings-table th,
.bookings-table td {
padding: 12px;
text-align: left;
border-bottom: 1px solid #e2e8f0;
}
.bookings-table th {
background: #f7fafc;
font-weight: 600;
}
.bookings-table tbody tr:hover {
background: #f7fafc;
}
.password-form {
text-align: center;
padding: 20px;
}
.password-input {
padding: 12px;
border: 2px solid #e2e8f0;
border-radius: 8px;
margin: 10px;
font-size: 16px;
}
.login-btn {
background: #667eea;
color: white;
border: none;
padding: 12px 24px;
border-radius: 8px;
cursor: pointer;
font-size: 16px;
}
.stats {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
gap: 15px;
margin-bottom: 20px;
}
.stat-card {
background: #f7fafc;
padding: 20px;
border-radius: 12px;
text-align: center;
}
.stat-number {
font-size: 24px;
font-weight: bold;
color: #667eea;
}
.stat-label {
font-size: 14px;
color: #666;
margin-top: 5px;
}
@media (max-width: 600px) {
.container {
padding: 30px 5px;
margin: 5px;
}
.calendar {
padding: 5px;
gap: 4px;
font-size: 13px;
}
.calendar-header {
padding: 0 2px;
font-size: 14px;
}
.calendar-day, .calendar-day-header {
font-size: 13px;
min-width: 0;
padding: 2px;
}
.slot-grid {
grid-template-columns: 1fr;
}
.admin-content {
width: 95%;
padding: 20px;
}
.bookings-table {
font-size: 14px;
}
.stats {
grid-template-columns: 1fr 1fr;
}
}
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1>üïç Kontrolle von Mezuzot und Tefillin in Wien 2025</h1>
<p>Online-Terminvereinbarung f√ºr die Kontrolle in Wien</p>
</div>
<div class="info-box">
<h3>‚Ñπ Informationen zur Buchung:</h3>
<ul>
<li><strong>Verf√ºgbare Zeiten:</strong> 10:00, 11:00, 12:00, 13:00, 14:00, 15:00, 16:00, 17:00</li>
<li><strong>Ort:</strong> Wien, √ñsterreich</li>
<li><strong>Dauer:</strong> ca. 30 Minuten</li>
<li><strong>Zeitraum:</strong> 12. August bis 7. September 2025 (au√üer Samstags)</li>
</ul>
</div>
<form id="bookingForm">
<div class="form-group">
<label for="name">üë§ Ihr Name *</label>
<input type="text" id="name" name="name" required placeholder="Geben Sie Ihren Namen ein">
</div>
<div class="form-group">
<label for="email">üìß E-Mail *</label>
<input type="email" id="email" name="email" required placeholder="beispiel@email.com">
</div>
<div class="form-group">
<label for="phone">üì± Telefon</label>
<input type="tel" id="phone" name="phone" placeholder="+43 xxx xxx xxxx">
</div>
<div class="form-group">
<label>üìÖ Schritt 1: Datum w√§hlen *</label>
<div class="calendar-header">
<button type="button" class="calendar-nav" id="prevMonthBtn">‚Äπ</button>
<div class="calendar-month" id="currentMonth"></div>
<button type="button" class="calendar-nav" id="nextMonthBtn">‚Ä∫</button>
</div>
<div class="calendar" id="calendar">
<!-- Kalender wird per JS generiert -->
</div>
</div>
<div class="form-group" id="timeSelectionGroup" style="display: none;">
<label>üïê Schritt 2: Uhrzeit w√§hlen *</label>
<div class="slot-grid" id="timesContainer">
<!-- Zeiten werden per JS eingef√ºgt -->
</div>
</div>
<div class="form-group">
<label for="notes">üí≠ Zus√§tzliche W√ºnsche</label>
<input type="text" id="notes" name="notes" placeholder="Besondere W√ºnsche oder Fragen">
</div>
<button type="submit" class="submit-btn" id="submitBtn">
üìù Termin buchen
</button>
</form>
<div id="message"></div>
</div>

<!-- Admin-Panel -->
<div class="admin-panel">
<button class="admin-btn" onclick="openAdminPanel()" title="Admin-Panel">‚öô</button>
</div>

<!-- Admin-Modal -->
<div class="admin-modal" id="adminModal">
<div class="admin-content">
<div class="admin-header">
<h2>üìä Admin-Panel</h2>
<button class="close-btn" onclick="closeAdminPanel()">‚úï</button>
</div>
<!-- Login-Formular -->
<div id="passwordForm" class="password-form">
<h3>Passwort eingeben</h3>
<input type="password" id="adminPassword" class="password-input" placeholder="Passwort">
<br>
<button class="login-btn" onclick="adminLogin()">Anmelden</button>
</div>
<!-- Admin-Inhalt -->
<div id="adminContent" style="display: none;">
<div class="stats">
<div class="stat-card">
<div class="stat-number" id="totalBookings">0</div>
<div class="stat-label">Gesamte Buchungen</div>
</div>
<div class="stat-card">
<div class="stat-number" id="todayBookings">0</div>
<div class="stat-label">Heute</div>
</div>
<div class="stat-card">
<div class="stat-number" id="availableSlots">0</div>
<div class="stat-label">Verf√ºgbare Slots</div>
</div>
<div class="stat-card">
<div class="stat-number" id="bookedSlots">0</div>
<div class="stat-label">Gebuchte Slots</div>
</div>
</div>
<table class="bookings-table">
<thead>
<tr>
<th>Buchungsdatum</th>
<th>Name</th>
<th>E-Mail</th>
<th>Telefon</th>
<th>Termin</th>
<th>Bemerkungen</th>
</tr>
</thead>
<tbody id="bookingsTableBody">
<!-- Daten kommen per JS -->
</tbody>
</table>
</div>
</div>
</div>

<script>
/* =========================
   –ù–ê–°–¢–†–û–ô–ö–ò
========================= */
// –í–°–¢–ê–í–¨ —Å—é–¥–∞ —Å–≤–æ–π Web App URL –∏–∑ Google Apps Script (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ /exec –Ω–∞ –∫–æ–Ω—Ü–µ)
const GAS_URL = 'https://script.google.com/macros/s/AKfycbzBJRh79ujLImd0W5PzlA1moLlwMCryZ0m5brij2r1YMak1tE6Xklj0iHDintErB-ck/exec';

// –†–∞–∑—Ä–µ—à—ë–Ω–Ω–æ–µ –æ–∫–Ω–æ –¥–∞—Ç (–º–µ–Ω—è–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
const WINDOW_START = '2025-08-12';
const WINDOW_END   = '2025-09-07';
const res = await fetch(GAS_URL, {
  method: 'POST',
  headers: { 'Content-Type': 'text/plain' },
  body: JSON.stringify({ action: 'list' })
});
const json = await res.json();        // { ok:true, rows:[...] }
const payload = {
  action: 'create',
  name, email, phone, notes,
  visit_date,  // 'YYYY-MM-DD'
  visit_time   // 'HH:mm'
};
const res = await fetch(GAS_URL, {
  method: 'POST',
  headers: { 'Content-Type': 'text/plain' },
  body: JSON.stringify(payload)
});
const json = await res.json();        // { ok:true, emailSent:true/false }


// –í—Ä–µ–º–µ–Ω–∞ —Å–ª–æ—Ç–æ–≤ –∑–∞ –¥–µ–Ω—å
const SLOT_TIMES = ['10:00','11:00','12:00','13:00','14:00','15:00','16:00','17:00'];

/* =========================
   –°–û–°–¢–û–Ø–ù–ò–ï
========================= */
let bookedSet     = new Set();        // –∑–∞–Ω—è—Ç—ã–µ —Å–ª–æ—Ç—ã: 'YYYY-MM-DD|HH:mm'
let currentDate   = new Date();       // –∫–∞–∫–æ–π –º–µ—Å—è—Ü –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
let selectedDate  = '';               // 'YYYY-MM-DD'
let selectedTime  = '';               // 'HH:mm'
let selectedSlot  = null;             // {date, time, formatted}

/* =========================
   –ü–û–ú–û–©–ù–ò–ö–ò –î–ê–¢
========================= */
function pad(n){ return n<10? '0'+n : ''+n; }
function ymd(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; }
function getDaysInMonth(date){ return new Date(date.getFullYear(), date.getMonth()+1, 0).getDate(); }
function getFirstDayOfMonth(date){
  // —Ö–æ—Ç–∏–º: –ü–Ω=0, ..., –í—Å=6
  const n = new Date(date.getFullYear(), date.getMonth(), 1).getDay(); // –í—Å=0..–°–±=6
  return (n+6)%7;
}
function isSaturday(d){ return d.getDay() === 6; }
function formatMonth(date){
  const m = date.toLocaleString('de-DE', { month: 'long' });
  return `${m.charAt(0).toUpperCase()+m.slice(1)} ${date.getFullYear()}`;
}
function formatDate(yyyy_mm_dd){
  const [y,m,d] = yyyy_mm_dd.split('-').map(Number);
  const dt = new Date(y, m-1, d);
  return dt.toLocaleDateString('de-DE', { day:'2-digit', month:'2-digit', year:'numeric' });
}

/* =========================
   –†–ê–ë–û–¢–ê –° –°–ï–†–í–ï–†–û–ú (GAS)
========================= */
async function fetchBookingsFromServer() {
  const res = await fetch(GAS_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'text/plain' },
    body: JSON.stringify({ action: 'list' })
  });

  let json;
  try {
    json = await res.json();
  } catch {
    json = JSON.parse(await res.text());
  }

  const rows = (json && json.rows) || [];
  bookedSet = new Set(
    rows
      .filter(r => r.visit_date && r.visit_time)
      .map(r => `${String(r.visit_date).slice(0,10)}|${String(r.visit_time)}`)
  );
}

async function saveBookingToServer(formData){
  const payload = {
    name: formData.name,
    email: formData.email,
    phone: formData.phone,
    notes: formData.notes,
    visit_date: formData.selectedSlot.date,
    visit_time: formData.selectedSlot.time
  };
  const res = await fetch(GAS_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'text/plain' }, // —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ preflight
    body: JSON.stringify(payload)
  });
  const data = await res.json();
  if (!data.ok) throw new Error(data.error || 'Save error');
  return data;
}
async function refreshFromServer(){
  try { await fetchBookingsFromServer(); }
  catch(e){ console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±—Ä–æ–Ω–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞:', e); }
  createCalendar(); // –ø–µ—Ä–µ—Ä–∏—Å—É–µ–º —Å —É—á—ë—Ç–æ–º bookedSet
}

/* =========================
   –†–ï–ù–î–ï–† –ö–ê–õ–ï–ù–î–ê–†–Ø
========================= */
function availableCount(dateStr){
  return SLOT_TIMES.filter(t => !bookedSet.has(`${dateStr}|${t}`)).length;
}
function createCalendar(){
  const cal = document.getElementById('calendar');
  const monthLabel = document.getElementById('currentMonth');
  if (!cal || !monthLabel) return;

  // –æ–≥—Ä–∞–Ω–∏—á–∏–º currentDate –≤ —Ä–∞–º–∫–∞—Ö –æ–∫–Ω–∞
  const start = new Date(WINDOW_START + 'T00:00:00');
  const end   = new Date(WINDOW_END   + 'T00:00:00');
  if (currentDate < new Date(start.getFullYear(), start.getMonth(), 1)) {
    currentDate = new Date(start.getFullYear(), start.getMonth(), 1);
  }
  if (currentDate > new Date(end.getFullYear(), end.getMonth(), 1)) {
    currentDate = new Date(end.getFullYear(), end.getMonth(), 1);
  }

  monthLabel.textContent = formatMonth(currentDate);
  cal.innerHTML = '';

  const headers = ['Mo','Di','Mi','Do','Fr','Sa','So'];
  headers.forEach(h=>{
    const el = document.createElement('div');
    el.className = 'calendar-day-header';
    el.textContent = h;
    cal.appendChild(el);
  });

  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  const today = new Date(); today.setHours(0,0,0,0);

  const daysInMonth = getDaysInMonth(currentDate);
  const firstDay = getFirstDayOfMonth(currentDate);

  for(let i=0;i<firstDay;i++){
    const empty = document.createElement('div');
    empty.className = 'calendar-day other-month';
    cal.appendChild(empty);
  }

  for(let day=1; day<=daysInMonth; day++){
    const cell = document.createElement('div');
    cell.className = 'calendar-day';

    const d = new Date(year, month, day);
    const dateStr = ymd(d);

    // –≤–Ω–µ –æ–∫–Ω–∞ –∏–ª–∏ —Å—É–±–±–æ—Ç–∞ ‚Äî –±–ª–æ–∫–∏—Ä—É–µ–º
    if (dateStr < WINDOW_START || dateStr > WINDOW_END || isSaturday(d)) {
      cell.classList.add('disabled');
      cal.appendChild(cell);
      continue;
    }

    const count = availableCount(dateStr);
    cell.innerHTML = `
      <div class="calendar-day-number">${day}</div>
      <div class="calendar-day-slots">${count>0 ? `${count} frei` : 'Belegt'}</div>
    `;

    if (d < today){
      cell.classList.add('disabled');
    } else if (count > 0){
      cell.classList.add('has-slots');
      cell.addEventListener('click', ()=> selectDate(dateStr, cell));
    } else {
      cell.classList.add('fully-booked');
    }
    cal.appendChild(cell);
  }
}

/* =========================
   –í–´–ë–û–† –î–ê–¢–´/–í–†–ï–ú–ï–ù–ò
========================= */
function clearSelectedDay(){
  document.querySelectorAll('.calendar-day.selected').forEach(el=> el.classList.remove('selected'));
}
function selectDate(dateStr, el){
  selectedDate = dateStr;
  selectedTime = '';
  selectedSlot = null;
  clearSelectedDay();
  el?.classList.add('selected');
  createTimeSelection();
  // –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏
  const btn = document.getElementById('submitBtn');
  if (btn) btn.disabled = true;
}
function createTimeSelection(){
  const box = document.getElementById('timesContainer');
  if (!box) return;
  box.innerHTML = '';
  SLOT_TIMES.forEach(time=>{
    const key = `${selectedDate}|${time}`;
    const isBooked = bookedSet.has(key);

    const item = document.createElement('div');
    item.className = 'slot-option' + (isBooked ? ' booked' : '');
    if (isBooked){
      item.innerHTML = `<div><strong>${time}</strong></div><div><small>‚ùå Belegt</small></div>`;
    } else {
      item.innerHTML = `<div><strong>${time}</strong></div><div><small>‚úÖ Frei</small></div>`;
      item.addEventListener('click', ()=> selectTime({date:selectedDate, time}, item));
    }
    box.appendChild(item);
  });
}
function clearSelectedTime(){
  document.querySelectorAll('.slot-option.selected').forEach(el=> el.classList.remove('selected'));
}
function selectTime(slot, el){
  selectedTime = slot.time;
  selectedSlot = {
    date: slot.date,
    time: slot.time,
    formatted: `${formatDate(slot.date)} um ${slot.time} Uhr`
  };
  clearSelectedTime();
  el?.classList.add('selected');
  const btn = document.getElementById('submitBtn');
  if (btn) btn.disabled = false;
}

/* =========================
   –ù–ê–í–ò–ì–ê–¶–ò–Ø –ü–û –ú–ï–°–Ø–¶–ê–ú
========================= */
function setupCalendarNavigation(){
  const prevBtn = document.getElementById('prevMonth');
  const nextBtn = document.getElementById('nextMonth');
  prevBtn?.addEventListener('click', ()=>{
    currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth()-1, 1);
    createCalendar();
  });
  nextBtn?.addEventListener('click', ()=>{
    currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth()+1, 1);
    createCalendar();
  });
}

/* =========================
   –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
========================= */
document.addEventListener('DOMContentLoaded', async ()=>{
  setupCalendarNavigation();
  // —Ä–∏—Å—É–µ–º —Ö–æ—Ç—è –±—ã –ø—É—Å—Ç–æ–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å
  createCalendar();
  // –ø—Ä–æ–±—É–µ–º –ø–æ–¥—Ç—è–Ω—É—Ç—å –∑–∞–Ω—è—Ç—ã–µ —Å–ª–æ—Ç—ã –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å
  await refreshFromServer().catch(()=>{ /* –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —É–ø–∞–ª ‚Äî —É–∂–µ –æ—Ç—Ä–∏—Å–æ–≤–∞–ª–∏ */ });
  // –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã (–µ—Å–ª–∏ –æ–Ω –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω —É —Ç–µ–±—è –≤—ã—à–µ)
  const form = document.getElementById('bookingForm');
  if (form) {
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      if (!selectedSlot){
        alert('Bitte w√§hlen Sie Datum und Zeit.');
        return;
      }
      const btn = document.getElementById('submitBtn');
      const orig = btn?.innerHTML || '';
      if (btn){ btn.disabled = true; btn.innerHTML = '<span class="loading"></span>Buchen...'; }

      const formData = {
        name:  document.getElementById('name')?.value.trim()  || '',
        email: document.getElementById('email')?.value.trim() || '',
        phone: document.getElementById('phone')?.value.trim() || '',
        notes: document.getElementById('notes')?.value.trim() || '',
        selectedSlot
      };

      try{
        await saveBookingToServer(formData);
        await refreshFromServer(); // —Å—Ä–∞–∑—É –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–Ω—è—Ç—ã–π —Å–ª–æ—Ç
        alert(`üéâ Erfolgreich gebucht f√ºr ${selectedSlot.formatted}`);
        // —Å–±—Ä–æ—Å
        selectedDate = ''; selectedTime=''; selectedSlot=null;
        createTimeSelection();
      } catch(err){
        console.error(err);
        alert('‚ùå Buchung fehlgeschlagen. Bitte versuchen Sie es erneut.');
        if (btn) btn.disabled = false;
      } finally {
        if (btn) btn.innerHTML = orig;
      }
    });
  }
});
</script>



</body>
</html>
