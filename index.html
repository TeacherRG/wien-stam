<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kontrolle von Mezuzot und Tefillin in Wien 2025</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}
body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
display: flex;
align-items: center;
justify-content: center;
padding: 20px;
}
.container {
background: white;
border-radius: 20px;
box-shadow: 0 20px 40px rgba(0,0,0,0.1);
padding: 40px;
max-width: 500px;
width: 100%;
animation: slideUp 0.6s ease-out;
overflow: hidden;
}
@keyframes slideUp {
from {
opacity: 0;
transform: translateY(30px);
}
to {
opacity: 1;
transform: translateY(0);
}
}
.header {
text-align: center;
margin-bottom: 30px;
}
.header h1 {
color: #2d3748;
font-size: 28px;
margin-bottom: 8px;
font-weight: 700;
}
.header p {
color: #718096;
font-size: 16px;
}
.form-group {
margin-bottom: 25px;
}
label {
display: block;
margin-bottom: 8px;
color: #2d3748;
font-weight: 600;
font-size: 14px;
}
input, select {
width: 100%;
padding: 12px 16px;
border: 2px solid #e2e8f0;
border-radius: 12px;
font-size: 16px;
transition: all 0.3s ease;
background: #f7fafc;
}
input:focus, select:focus {
outline: none;
border-color: #667eea;
background: white;
box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}
.slot-option {
padding: 15px 20px;
border: 2px solid #e2e8f0;
border-radius: 12px;
background: #f7fafc;
cursor: pointer;
transition: all 0.3s ease;
text-align: center;
font-weight: 500;
}
.slot-option:hover {
border-color: #667eea;
background: #edf2f7;
transform: translateY(-2px);
}
.slot-option.selected {
border-color: #667eea;
background: #667eea;
color: white;
box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}
.slot-option.booked {
background: #fed7d7;
border-color: #fc8181;
color: #c53030;
cursor: not-allowed;
opacity: 0.6;
}
.slot-option.booked:hover {
transform: none;
}
.calendar {
display: grid;
grid-template-columns: repeat(7, 1fr);
gap: 8px;
margin-top: 15px;
padding: 20px;
background: #f7fafc;
border-radius: 12px;
border: 2px solid #e2e8f0;
width: 100%;
box-sizing: border-box;
max-width: 100%;
min-width: 0;
overflow-x: auto;
}
.calendar-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
padding: 0 10px;
width: 100%;
box-sizing: border-box;
}
.calendar-nav {
background: #667eea;
color: white;
border: none;
border-radius: 8px;
padding: 8px 12px;
cursor: pointer;
font-size: 16px;
font-weight: bold;
}
.calendar-nav:hover {
background: #5a6fd8;
}
.calendar-month {
font-size: 18px;
font-weight: 600;
color: #2d3748;
}
.calendar-day-header {
text-align: center;
font-weight: 600;
color: #4a5568;
padding: 10px 5px;
font-size: 14px;
min-width: 0;
word-break: break-word;
}
.calendar-day {
aspect-ratio: 1;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
background: white;
border: 2px solid #e2e8f0;
border-radius: 8px;
cursor: pointer;
transition: all 0.3s ease;
font-weight: 500;
position: relative;
min-height: 60px;
min-width: 0;
word-break: break-word;
}
.calendar-day:hover:not(.disabled):not(.other-month) {
border-color: #667eea;
background: #edf2f7;
transform: scale(1.05);
}
.calendar-day.selected {
border-color: #667eea;
background: #667eea;
color: white;
box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}
.calendar-day.disabled {
background: #f7fafc;
color: #a0aec0;
cursor: not-allowed;
opacity: 0.6;
}
.calendar-day.other-month {
color: #cbd5e0;
background: #f7fafc;
}
.calendar-day.has-slots {
border-color: #48bb78;
background: #f0fff4;
}
.calendar-day.has-slots:hover {
border-color: #38a169;
background: #c6f6d5;
}
.calendar-day.fully-booked {
background: #fed7d7;
border-color: #fc8181;
color: #c53030;
}
.calendar-day-number {
font-size: 16px;
margin-bottom: 2px;
}
.calendar-day-slots {
font-size: 10px;
opacity: 0.8;
}
.slot-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 12px;
margin-top: 15px;
}
.submit-btn {
width: 100%;
padding: 15px;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
border: none;
border-radius: 12px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
margin-top: 20px;
}
.submit-btn:hover:not(:disabled) {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
}
.submit-btn:disabled {
opacity: 0.6;
cursor: not-allowed;
transform: none;
}
.success-message {
background: #c6f6d5;
color: #22543d;
padding: 15px 20px;
border-radius: 12px;
margin-top: 20px;
text-align: center;
font-weight: 500;
border: 2px solid #9ae6b4;
}
.error-message {
background: #fed7d7;
color: #c53030;
padding: 15px 20px;
border-radius: 12px;
margin-top: 20px;
text-align: center;
font-weight: 500;
border: 2px solid #fc8181;
}
.loading {
display: inline-block;
width: 20px;
height: 20px;
border: 3px solid #ffffff;
border-radius: 50%;
border-top-color: transparent;
animation: spin 1s ease-in-out infinite;
margin-right: 10px;
}
@keyframes spin {
to { transform: rotate(360deg); }
}
.info-box {
background: #ebf8ff;
border: 2px solid #90cdf4;
border-radius: 12px;
padding: 20px;
margin-bottom: 25px;
color: #2a4365;
}
.info-box h3 {
margin-bottom: 10px;
color: #2c5282;
}
.info-box ul {
list-style-position: inside;
line-height: 1.6;
}
.admin-panel {
position: fixed;
top: 20px;
right: 20px;
z-index: 1000;
}
.admin-btn {
background: #2d3748;
color: white;
border: none;
border-radius: 50%;
width: 50px;
height: 50px;
cursor: pointer;
font-size: 18px;
box-shadow: 0 4px 12px rgba(0,0,0,0.3);
transition: all 0.3s ease;
}
.admin-btn:hover {
background: #4a5568;
transform: scale(1.1);
}
.admin-modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0,0,0,0.8);
z-index: 2000;
display: none;
align-items: center;
justify-content: center;
}
.admin-content {
background: white;
border-radius: 20px;
padding: 30px;
max-width: 800px;
width: 90%;
max-height: 80vh;
overflow-y: auto;
}
.admin-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}
.close-btn {
background: none;
border: none;
font-size: 24px;
cursor: pointer;
color: #666;
}
.bookings-table {
width: 100%;
border-collapse: collapse;
margin-top: 20px;
}
.bookings-table th,
.bookings-table td {
padding: 12px;
text-align: left;
border-bottom: 1px solid #e2e8f0;
}
.bookings-table th {
background: #f7fafc;
font-weight: 600;
}
.bookings-table tbody tr:hover {
background: #f7fafc;
}
.password-form {
text-align: center;
padding: 20px;
}
.password-input {
padding: 12px;
border: 2px solid #e2e8f0;
border-radius: 8px;
margin: 10px;
font-size: 16px;
}
.login-btn {
background: #667eea;
color: white;
border: none;
padding: 12px 24px;
border-radius: 8px;
cursor: pointer;
font-size: 16px;
}
.stats {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
gap: 15px;
margin-bottom: 20px;
}
.stat-card {
background: #f7fafc;
padding: 20px;
border-radius: 12px;
text-align: center;
}
.stat-number {
font-size: 24px;
font-weight: bold;
color: #667eea;
}
.stat-label {
font-size: 14px;
color: #666;
margin-top: 5px;
}
@media (max-width: 600px) {
.container {
padding: 30px 5px;
margin: 5px;
}
.calendar {
padding: 5px;
gap: 4px;
font-size: 13px;
}
.calendar-header {
padding: 0 2px;
font-size: 14px;
}
.calendar-day, .calendar-day-header {
font-size: 13px;
min-width: 0;
padding: 2px;
}
.slot-grid {
grid-template-columns: 1fr;
}
.admin-content {
width: 95%;
padding: 20px;
}
.bookings-table {
font-size: 14px;
}
.stats {
grid-template-columns: 1fr 1fr;
}
}
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1>üïç Kontrolle von Mezuzot und Tefillin in Wien 2025</h1>
<p>Online-Terminvereinbarung f√ºr die Kontrolle in Wien</p>
</div>
<div class="info-box">
<h3>‚Ñπ Informationen zur Buchung:</h3>
<ul>
<li><strong>Verf√ºgbare Zeiten:</strong> 10:00, 11:00, 12:00, 13:00, 14:00, 15:00, 16:00, 17:00</li>
<li><strong>Ort:</strong> Wien, √ñsterreich</li>
<li><strong>Dauer:</strong> ca. 30 Minuten</li>
<li><strong>Zeitraum:</strong> 12. August bis 7. September 2025 (au√üer Samstags)</li>
</ul>
</div>
<form id="bookingForm">
<div class="form-group">
<label for="name">üë§ Ihr Name *</label>
<input type="text" id="name" name="name" required placeholder="Geben Sie Ihren Namen ein">
</div>
<div class="form-group">
<label for="email">üìß E-Mail *</label>
<input type="email" id="email" name="email" required placeholder="beispiel@email.com">
</div>
<div class="form-group">
<label for="phone">üì± Telefon</label>
<input type="tel" id="phone" name="phone" placeholder="+43 xxx xxx xxxx">
</div>
<div class="form-group">
<label>üìÖ Schritt 1: Datum w√§hlen *</label>
<div class="calendar-header">
<button type="button" class="calendar-nav" id="prevMonthBtn">‚Äπ</button>
<div class="calendar-month" id="currentMonth"></div>
<button type="button" class="calendar-nav" id="nextMonthBtn">‚Ä∫</button>
</div>
<div class="calendar" id="calendar">
<!-- Kalender wird per JS generiert -->
</div>
</div>
<div class="form-group" id="timeSelectionGroup" style="display: none;">
<label>üïê Schritt 2: Uhrzeit w√§hlen *</label>
<div class="slot-grid" id="timesContainer">
<!-- Zeiten werden per JS eingef√ºgt -->
</div>
</div>
<div class="form-group">
<label for="notes">üí≠ Zus√§tzliche W√ºnsche</label>
<input type="text" id="notes" name="notes" placeholder="Besondere W√ºnsche oder Fragen">
</div>
<button type="submit" class="submit-btn" id="submitBtn">
üìù Termin buchen
</button>
</form>
<div id="message"></div>
</div>

<!-- Admin-Panel -->
<div class="admin-panel">
<button class="admin-btn" onclick="openAdminPanel()" title="Admin-Panel">‚öô</button>
</div>

<!-- Admin-Modal -->
<div class="admin-modal" id="adminModal">
<div class="admin-content">
<div class="admin-header">
<h2>üìä Admin-Panel</h2>
<button class="close-btn" onclick="closeAdminPanel()">‚úï</button>
</div>
<!-- Login-Formular -->
<div id="passwordForm" class="password-form">
<h3>Passwort eingeben</h3>
<input type="password" id="adminPassword" class="password-input" placeholder="Passwort">
<br>
<button class="login-btn" onclick="adminLogin()">Anmelden</button>
</div>
<!-- Admin-Inhalt -->
<div id="adminContent" style="display: none;">
<div class="stats">
<div class="stat-card">
<div class="stat-number" id="totalBookings">0</div>
<div class="stat-label">Gesamte Buchungen</div>
</div>
<div class="stat-card">
<div class="stat-number" id="todayBookings">0</div>
<div class="stat-label">Heute</div>
</div>
<div class="stat-card">
<div class="stat-number" id="availableSlots">0</div>
<div class="stat-label">Verf√ºgbare Slots</div>
</div>
<div class="stat-card">
<div class="stat-number" id="bookedSlots">0</div>
<div class="stat-label">Gebuchte Slots</div>
</div>
</div>
<table class="bookings-table">
<thead>
<tr>
<th>Buchungsdatum</th>
<th>Name</th>
<th>E-Mail</th>
<th>Telefon</th>
<th>Termin</th>
<th>Bemerkungen</th>
</tr>
</thead>
<tbody id="bookingsTableBody">
<!-- Daten kommen per JS -->
</tbody>
</table>
</div>
</div>
</div>

<script>
// URL Google Apps Script - –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–®–ò –î–ê–ù–ù–´–ï!
window.SCRIPT_URL = '–í–ê–®_URL_GOOGLE_APPS_SCRIPT'; // <- –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ó–ê–ú–ï–ù–ò–¢–ï!

// –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
console.log('üîß –õ–û–ö–ê–õ–¨–ù–ê–Ø –û–¢–õ–ê–î–ö–ê –ó–ê–ü–£–©–ï–ù–ê');
console.log('Origin:', window.location.origin);
console.log('SCRIPT_URL:', window.SCRIPT_URL);

// Hilfsfunktion: ist Samstag?
function isSaturday(dateObj) {
    return dateObj.getDay() === 6; // 0 = Sonntag ... 6 = Samstag
}

// Generierung der Slots f√ºr den Bereich (12.08.2025‚Äì07.09.2025, au√üer Samstag)
function generateTimeSlots() {
    const start = new Date('2025-08-12');
    const end = new Date('2025-09-07');
    const slotTimes = ['10:00','11:00','12:00','13:00','14:00','15:00','16:00','17:00'];
    let slots = [];
    
    for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
        if (isSaturday(d)) continue;
        const dateStr = d.toISOString().split('T')[0];
        slotTimes.forEach(time => {
            slots.push({ date: dateStr, time: time, booked: false });
        });
    }
    return slots;
}

const timeSlots = generateTimeSlots();
let selectedDate = null;
let selectedTime = null;
let selectedSlot = null;
let currentDate = new Date('2025-08-12'); // –ù–∞—á–∏–Ω–∞–µ–º —Å –ø–µ—Ä–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –¥–Ω—è
let bookingsData = [];
const ADMIN_PASSWORD = 'tefillin2025';

console.log('üìÖ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª–æ—Ç—ã...', timeSlots.length, '—Å–ª–æ—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω–æ');
console.log('üìÖ –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è:', currentDate);

function formatDate(dateString) {
    const date = new Date(dateString);
    const options = {
        weekday: 'short',
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
    };
    return date.toLocaleDateString('de-DE', options);
}

function formatMonth(date) {
    const options = { month: 'long', year: 'numeric' };
    return date.toLocaleDateString('de-DE', options);
}

function getDaysInMonth(date) {
    return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
}

function getFirstDayOfMonth(date) {
    const firstDay = new Date(date.getFullYear(), date.getMonth(), 1).getDay();
    return firstDay === 0 ? 6 : firstDay - 1;
}

function getSlotsForDate(dateString) {
    return timeSlots.filter(slot => slot.date === dateString);
}

function createCalendar() {
    console.log('üóìÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –¥–ª—è:', formatMonth(currentDate));
    
    const calendar = document.getElementById('calendar');
    const monthLabel = document.getElementById('currentMonth');
    
    if (!calendar) {
        console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—è –Ω–µ –Ω–∞–π–¥–µ–Ω!');
        return;
    }
    
    monthLabel.textContent = formatMonth(currentDate);
    calendar.innerHTML = '';
    
    const dayHeaders = ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'];
    dayHeaders.forEach(day => {
        const dayHeader = document.createElement('div');
        dayHeader.className = 'calendar-day-header';
        dayHeader.textContent = day;
        calendar.appendChild(dayHeader);
    });
    
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    const today = new Date('2025-08-24'); // –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞
    today.setHours(0, 0, 0, 0);
    
    console.log('üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å:', { year, month, today: today.toISOString() });
    
    const daysInMonth = getDaysInMonth(currentDate);
    const firstDayOfMonth = getFirstDayOfMonth(currentDate);
    
    console.log('üìä –î–Ω–µ–π –≤ –º–µ—Å—è—Ü–µ:', daysInMonth, '–ü–µ—Ä–≤—ã–π –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏:', firstDayOfMonth);
    
    // –ü—É—Å—Ç—ã–µ –¥–Ω–∏ –≤ –Ω–∞—á–∞–ª–µ –º–µ—Å—è—Ü–∞
    for (let i = 0; i < firstDayOfMonth; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'calendar-day other-month';
        emptyDay.innerHTML = '&nbsp;';
        calendar.appendChild(emptyDay);
    }
    
    // –î–Ω–∏ –º–µ—Å—è—Ü–∞
    for (let day = 1; day <= daysInMonth; day++) {
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        const dayDate = new Date(year, month, day);
        const dateString = dayDate.toISOString().split('T')[0];
        
        console.log('üìÖ –î–µ–Ω—å:', day, '–î–∞—Ç–∞:', dateString, '–°—É–±–±–æ—Ç–∞:', isSaturday(dayDate));
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ —ç—Ç–æ—Ç –¥–µ–Ω—å –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        if (dateString < '2025-08-12' || dateString > '2025-09-07' || isSaturday(dayDate)) {
            dayElement.classList.add('disabled');
            dayElement.innerHTML = `<div class="calendar-day-number">${day}</div>`;
            console.log('‚ùå –î–µ–Ω—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', day);
        } else {
            const slotsForDate = getSlotsForDate(dateString);
            const availableSlots = slotsForDate.filter(slot => !slot.booked);
            
            console.log('‚úÖ –î–µ–Ω—å –¥–æ—Å—Ç—É–ø–µ–Ω:', day, '–°–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤:', availableSlots.length);
            
            dayElement.innerHTML = `
                <div class="calendar-day-number">${day}</div>
                <div class="calendar-day-slots">${availableSlots.length > 0 ? `${availableSlots.length} frei` : ''}</div>
            `;
            
            if (dayDate < today) {
                dayElement.classList.add('disabled');
                console.log('‚è∞ –î–µ–Ω—å –≤ –ø—Ä–æ—à–ª–æ–º:', day);
            } else if (availableSlots.length > 0) {
                dayElement.classList.add('has-slots');
                dayElement.addEventListener('click', () => selectDate(dateString, dayElement));
                console.log('üü¢ –î–µ–Ω—å —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏:', day);
            } else if (slotsForDate.length > 0) {
                dayElement.classList.add('fully-booked');
                dayElement.innerHTML = `
                    <div class="calendar-day-number">${day}</div>
                    <div class="calendar-day-slots">Belegt</div>
                `;
                console.log('üî¥ –î–µ–Ω—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω:', day);
            }
        }
        
        calendar.appendChild(dayElement);
    }
    
    console.log('‚úÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–∑–¥–∞–Ω, —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–æ:', calendar.children.length);
}

function setupCalendarNavigation() {
    document.getElementById('prevMonthBtn').addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        createCalendar();
        resetTimeSelection();
    });
    
    document.getElementById('nextMonthBtn').addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        createCalendar();
        resetTimeSelection();
    });
}

function resetTimeSelection() {
    selectedDate = null;
    selectedTime = null;
    selectedSlot = null;
    document.getElementById('timeSelectionGroup').style.display = 'none';
    document.getElementById('submitBtn').disabled = true;
}

function selectDate(dateString, element) {
    // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –¥–∞—Ç
    document.querySelectorAll('.calendar-day.selected').forEach(el => {
        el.classList.remove('selected');
    });
    
    element.classList.add('selected');
    selectedDate = dateString;
    selectedTime = null;
    selectedSlot = null;
    
    document.getElementById('timeSelectionGroup').style.display = 'block';
    createTimeSelection();
    
    // –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –∫ –≤—Ä–µ–º–µ–Ω–∏
    document.getElementById('timeSelectionGroup').scrollIntoView({
        behavior: 'smooth',
        block: 'nearest'
    });
    
    document.getElementById('submitBtn').disabled = true;
}

function createTimeSelection() {
    const container = document.getElementById('timesContainer');
    container.innerHTML = '';
    
    const timesForDate = getSlotsForDate(selectedDate);
    
    timesForDate.forEach(slot => {
        const timeElement = document.createElement('div');
        timeElement.className = 'slot-option';
        
        if (slot.booked) {
            timeElement.className += ' booked';
            timeElement.innerHTML = `
                <div><strong>${slot.time}</strong></div>
                <div><small>‚ùå Belegt</small></div>
            `;
        } else {
            timeElement.innerHTML = `
                <div><strong>${slot.time}</strong></div>
                <div><small>‚úÖ Frei</small></div>
            `;
            timeElement.addEventListener('click', () => selectTime(slot, timeElement));
        }
        
        container.appendChild(timeElement);
    });
}

function selectTime(slot, element) {
    // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤—Ä–µ–º–µ–Ω
    document.querySelectorAll('#timesContainer .slot-option.selected').forEach(el => {
        el.classList.remove('selected');
    });
    
    element.classList.add('selected');
    selectedTime = slot.time;
    selectedSlot = slot;
    document.getElementById('submitBtn').disabled = false;
}

// –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –æ—Ç–ª–∞–¥–∫–æ–π
async function simulateBooking(data) {
    console.log('üì° –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:', data);
    
    try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL
        if (!window.SCRIPT_URL || window.SCRIPT_URL.includes('–í–ê–®_URL')) {
            console.log('‚ö†Ô∏è URL –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ');
            return await localBookingFallback(data);
        }
        
        console.log('üåê –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä:', window.SCRIPT_URL);
        
        const response = await fetch(window.SCRIPT_URL, {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
            mode: 'cors'
        });
        
        console.log('üì® –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response.status);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const result = await response.json();
        console.log('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:', result);
        
        if (!result.ok) {
            throw new Error(result.error || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        bookingsData.push({
            id: Date.now(),
            bookingDate: new Date(),
            name: data.name,
            email: data.email,
            phone: data.phone,
            visitDate: data.selectedSlot.date,
            visitTime: data.selectedSlot.time,
            notes: data.notes,
            status: 'confirmed'
        });
        
        return result;
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
        
        // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–µ—Ç–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º
        if (error.name === 'TypeError' || error.message.includes('fetch')) {
            console.log('üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º...');
            return await localBookingFallback(data);
        }
        
        throw error;
    }
}

// –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤
async function localBookingFallback(data) {
    console.log('üíæ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö');
    
    // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    bookingsData.push({
        id: Date.now(),
        bookingDate: new Date(),
        name: data.name,
        email: data.email,
        phone: data.phone,
        visitDate: data.selectedSlot.date,
        visitTime: data.selectedSlot.time,
        notes: data.notes,
        status: 'confirmed'
    });
    
    return {
        ok: true,
        message: '–õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)',
        booking: {
            date: data.selectedSlot.date,
            time: data.selectedSlot.time,
            name: data.name,
            email: data.email
        }
    };
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
document.getElementById('bookingForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    if (!selectedSlot || !selectedDate || !selectedTime) {
        showMessage('Bitte w√§hlen Sie ein Datum und eine Uhrzeit.', 'error');
        return;
    }
    
    const submitBtn = document.getElementById('submitBtn');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<span class="loading"></span>Buchen...';
    submitBtn.disabled = true;
    
    const formData = {
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        notes: document.getElementById('notes').value,
        selectedSlot: {
            date: selectedDate,
            time: selectedTime,
            formatted: `${formatDate(selectedDate)} um ${selectedTime} Uhr`
        },
        timestamp: new Date().toISOString()
    };
    
    try {
        const result = await simulateBooking(formData);
        
        // –û—Ç–º–µ—Ç–∏—Ç—å —Å–ª–æ—Ç –∫–∞–∫ –∑–∞–Ω—è—Ç—ã–π
        selectedSlot.booked = true;
        
        let successMessage = `üéâ Erfolgreich gebucht f√ºr ${formData.selectedSlot.formatted}.`;
        
        if (result.message && result.message.includes('Lokales')) {
            successMessage += '\n‚ö†Ô∏è (Testmodus - Daten lokal gespeichert)';
        } else {
            successMessage += `\nEine Best√§tigung wurde an ${formData.email} gesendet.`;
        }
        
        showMessage(successMessage, 'success');
        resetInterface();
        
    } catch (error) {
        console.error('Booking error:', error);
        showMessage('‚ùå Buchung fehlgeschlagen. Bitte versuchen Sie es erneut.', 'error');
    } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = true;
    }
});

function resetInterface() {
    document.getElementById('bookingForm').reset();
    selectedDate = null;
    selectedTime = null;
    selectedSlot = null;
    document.getElementById('timeSelectionGroup').style.display = 'none';
    createCalendar();
    document.getElementById('timesContainer').innerHTML = '';
    document.getElementById('submitBtn').disabled = true;
}

// Admin-Panel Funktionen
function openAdminPanel() {
    document.getElementById('adminModal').style.display = 'flex';
}

function closeAdminPanel() {
    document.getElementById('adminModal').style.display = 'none';
    document.getElementById('passwordForm').style.display = 'block';
    document.getElementById('adminContent').style.display = 'none';
    document.getElementById('adminPassword').value = '';
}

function adminLogin() {
    const password = document.getElementById('adminPassword').value;
    if (password === ADMIN_PASSWORD) {
        document.getElementById('passwordForm').style.display = 'none';
        document.getElementById('adminContent').style.display = 'block';
        loadAdminData();
    } else {
        alert('‚ùå Falsches Passwort!');
        document.getElementById('adminPassword').value = '';
    }
}

function loadAdminData() {
    updateAdminStats();
    loadBookingsTable();
}

function updateAdminStats() {
    const today = new Date().toISOString().split('T')[0];
    const todayBookings = bookingsData.filter(booking =>
        booking.bookingDate.toISOString().split('T')[0] === today
    ).length;
    
    const totalAvailable = timeSlots.filter(slot => !slot.booked).length;
    const totalBooked = timeSlots.filter(slot => slot.booked).length;
    
    document.getElementById('totalBookings').textContent = bookingsData.length;
    document.getElementById('todayBookings').textContent = todayBookings;
    document.getElementById('availableSlots').textContent = totalAvailable;
    document.getElementById('bookedSlots').textContent = totalBooked;
}

function loadBookingsTable() {
    const tbody = document.getElementById('bookingsTableBody');
    tbody.innerHTML = '';
    
    const sortedBookings = [...bookingsData].sort((a, b) =>
        new Date(b.bookingDate) - new Date(a.bookingDate)
    );
    
    sortedBookings.forEach(booking => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${formatDateTime(booking.bookingDate)}</td>
            <td><strong>${booking.name}</strong></td>
            <td><a href="mailto:${booking.email}">${booking.email}</a></td>
            <td>${booking.phone || 'Nicht angegeben'}</td>
            <td><strong>${formatDate(booking.visitDate)} um ${booking.visitTime} Uhr</strong></td>
            <td>${booking.notes || 'Keine'}</td>
        `;
        tbody.appendChild(row);
    });
    
    if (bookingsData.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = '<td colspan="6" style="text-align: center; color: #666;">Noch keine Buchungen</td>';
        tbody.appendChild(row);
    }
}

function formatDateTime(date) {
    return new Date(date).toLocaleString('de-DE', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}

function showMessage(text, type) {
    const messageDiv = document.getElementById('message');
    messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
    messageDiv.innerHTML = text;
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
        messageDiv.innerHTML = '';
        messageDiv.className = '';
    }, 10000);
}

// –¢–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
async function testConnection() {
    if (!window.SCRIPT_URL || window.SCRIPT_URL.includes('–í–ê–®_URL')) {
        console.log('‚ö†Ô∏è URL –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
        return false;
    }
    
    try {
        console.log('üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫:', window.SCRIPT_URL);
        
        const response = await fetch(window.SCRIPT_URL, {
            method: 'GET',
            mode: 'cors'
        });
        
        console.log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ:', response.status);
        const data = await response.json();
        console.log('üìä –î–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞:', data);
        return true;
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', error);
        return false;
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º—ã...');
    console.log('üåê Origin:', window.location.origin);
    console.log('üì° SCRIPT_URL:', window.SCRIPT_URL);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç—ã DOM –¥–æ—Å—Ç—É–ø–Ω—ã
    const calendar = document.getElementById('calendar');
    const submitBtn = document.getElementById('submitBtn');
    
    if (!calendar) {
        console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—è –Ω–µ –Ω–∞–π–¥–µ–Ω!');
        return;
    }
    
    if (!submitBtn) {
        console.error('‚ùå –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
        return;
    }
    
    console.log('‚úÖ DOM —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã');
    
    // –°–æ–∑–¥–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    createCalendar();
    setupCalendarNavigation();
    submitBtn.disabled = true;
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
    setTimeout(() => {
        const calendarVisible = calendar.offsetHeight > 0;
        console.log('üëÅÔ∏è –ö–∞–ª–µ–Ω–¥–∞—Ä—å –≤–∏–¥–∏–º—ã–π:', calendarVisible);
        console.log('üìè –†–∞–∑–º–µ—Ä—ã –∫–∞–ª–µ–Ω–¥–∞—Ä—è:', {
            width: calendar.offsetWidth,
            height: calendar.offsetHeight,
            children: calendar.children.length
        });
        
        if (!calendarVisible || calendar.children.length === 0) {
            console.log('üîÑ –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å...');
            createCalendar();
        }
    }, 100);
    
    // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
        testConnection();
    }, 2000);
    
    console.log('‚úÖ –§–æ—Ä–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é');
});
</script>
</body>
</html>
